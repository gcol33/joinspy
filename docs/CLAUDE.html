<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>CLAUDE.md • joinspy</title><script src="lightswitch.js"></script><script src="deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="deps/headroom-0.11.0/headroom.min.js"></script><script src="deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="deps/search-1.0.0/fuse.min.js"></script><script src="deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="pkgdown.js"></script><link href="extra.css" rel="stylesheet"><meta property="og:title" content="CLAUDE.md"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="index.html">joinspy</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.7.1</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="nav-item"><a class="nav-link" href="reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="articles/introduction.html">Get Started</a></li>
<li class="nav-item"><a class="nav-link" href="articles/common-issues.html">Common Issues</a></li>
<li class="nav-item"><a class="nav-link" href="news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="search.json"></form></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch"><li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/gcol33/joinspy" aria-label="GitHub"><span class="fa fa-github"></span></a></li>
      </ul></div>


  </div>
</nav><div class="container template-title-body">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>CLAUDE.md</h1>
      <small class="dont-index">Source: <a href="https://github.com/gcol33/joinspy/blob/HEAD/CLAUDE.md" class="external-link"><code>CLAUDE.md</code></a></small>
    </div>

<div id="claudemd" class="section level1">

<p>This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.</p>
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a></h2>
<p><strong>joinspy</strong> is an R package that provides diagnostic tools for data frame joins. It helps users understand and debug join operations by analyzing key columns before and after joins, detecting common issues (duplicates, mismatches, encoding problems), and explaining unexpected row count changes.</p>
</div>
<div class="section level2">
<h2 id="development-commands">Development Commands<a class="anchor" aria-label="anchor" href="#development-commands"></a></h2>
<div class="section level3">
<h3 id="build-and-install">Build and Install<a class="anchor" aria-label="anchor" href="#build-and-install"></a></h3>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Load package for development</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/load_all.html" class="external-link">load_all</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Install package locally</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/install.html" class="external-link">install</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Regenerate documentation (after roxygen2 changes)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/document.html" class="external-link">document</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="testing">Testing<a class="anchor" aria-label="anchor" href="#testing"></a></h3>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Run full test suite</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/test.html" class="external-link">test</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run complete package check (includes tests, examples, documentation)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/check.html" class="external-link">check</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Run specific test file during development</span></span>
<span><span class="fu">testthat</span><span class="fu">::</span><span class="fu"><a href="https://testthat.r-lib.org/reference/test_file.html" class="external-link">test_file</a></span><span class="op">(</span><span class="st">"tests/testthat/test-join_spy.R"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="documentation">Documentation<a class="anchor" aria-label="anchor" href="#documentation"></a></h3>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Build vignettes</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu"><a href="https://devtools.r-lib.org/reference/build_vignettes.html" class="external-link">build_vignettes</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Build pkgdown site locally (output in docs/)</span></span>
<span><span class="fu">pkgdown</span><span class="fu">::</span><span class="fu"><a href="https://pkgdown.r-lib.org/reference/build_site.html" class="external-link">build_site</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="architecture">Architecture<a class="anchor" aria-label="anchor" href="#architecture"></a></h2>
<div class="section level3">
<h3 id="high-level-design">High-Level Design<a class="anchor" aria-label="anchor" href="#high-level-design"></a></h3>
<p>The package provides diagnostic functions organized into three categories:</p>
<ol style="list-style-type: decimal"><li>
<strong>Pre-join diagnostics</strong> - Analyze tables before joining
<ul><li>
<code><a href="reference/join_spy.html">join_spy()</a></code> - Comprehensive pre-flight report</li>
<li>
<code><a href="reference/key_check.html">key_check()</a></code> - Quick key quality assessment</li>
<li>
<code><a href="reference/key_duplicates.html">key_duplicates()</a></code> - Find duplicate keys</li>
</ul></li>
<li>
<strong>Post-join diagnostics</strong> - Understand what happened after a join
<ul><li>
<code><a href="reference/join_explain.html">join_explain()</a></code> - Explain row count changes</li>
<li>
<code><a href="reference/join_diff.html">join_diff()</a></code> - Compare before/after states</li>
</ul></li>
<li>
<strong>Safe join wrappers</strong> - Joins with built-in diagnostics
<ul><li>
<code><a href="reference/left_join_spy.html">left_join_spy()</a></code> - left_join with automatic reporting</li>
<li>
<code><a href="reference/join_strict.html">join_strict()</a></code> - Fails if cardinality constraints violated</li>
</ul></li>
</ol></div>
<div class="section level3">
<h3 id="core-data-structures">Core Data Structures<a class="anchor" aria-label="anchor" href="#core-data-structures"></a></h3>
<p><strong>JoinReport S3 class</strong> - Returned by <code><a href="reference/join_spy.html">join_spy()</a></code> and related functions: - <code>x_summary</code> - Summary of left table keys - <code>y_summary</code> - Summary of right table keys - <code>match_analysis</code> - What will/won’t match - <code>issues</code> - Detected problems (duplicates, whitespace, encoding, case) - <code>expected_rows</code> - Predicted row counts for each join type</p>
</div>
<div class="section level3">
<h3 id="key-detection-logic">Key Detection Logic<a class="anchor" aria-label="anchor" href="#key-detection-logic"></a></h3>
<p>The package detects these common issues: 1. <strong>Duplicate keys</strong> - Keys appearing multiple times (causes row multiplication) 2. <strong>Trailing/leading whitespace</strong> - Invisible characters breaking matches 3. <strong>Case mismatches</strong> - “ABC” vs “abc” that won’t match 4. <strong>Encoding issues</strong> - UTF-8 vs Latin-1, invisible Unicode characters 5. <strong>NA keys</strong> - Missing values in join columns</p>
</div>
</div>
<div class="section level2">
<h2 id="file-organization">File Organization<a class="anchor" aria-label="anchor" href="#file-organization"></a></h2>
<pre><code>R/                           # R source files
├── join_spy.R              # Main diagnostic function
├── key_check.R             # Key quality assessment
├── key_duplicates.R        # Duplicate detection
├── join_explain.R          # Post-join explanation
├── join_diff.R             # Before/after comparison
├── join_strict.R           # Cardinality-enforcing joins
├── join_wrappers.R         # *_join_spy() convenience functions
├── JoinReport.R            # S3 class definition and print method
├── string_diagnostics.R    # Encoding/whitespace detection utilities
└── joinspy-package.R       # Package-level documentation

tests/testthat/             # Unit tests
├── test-join_spy.R
├── test-key_check.R
├── test-join_explain.R
├── test-join_strict.R
└── test-string_diagnostics.R

vignettes/                   # Long-form documentation
├── introduction.Rmd        # Getting started guide
└── common-issues.Rmd       # Catalogue of join problems and solutions

man/                         # Generated documentation (roxygen2)
docs/                        # Generated pkgdown website</code></pre>
</div>
<div class="section level2">
<h2 id="important-conventions">Important Conventions<a class="anchor" aria-label="anchor" href="#important-conventions"></a></h2>
<div class="section level3">
<h3 id="function-naming">Function Naming<a class="anchor" aria-label="anchor" href="#function-naming"></a></h3>
<ul><li>Diagnostic functions: <code>join_*</code> or <code>key_*</code> prefix</li>
<li>Safe wrappers: <code>*_join_spy</code> suffix (e.g., <code>left_join_spy</code>)</li>
<li>Internal helpers: <code>.</code> prefix (e.g., <code>.detect_whitespace</code>)</li>
</ul></div>
<div class="section level3">
<h3 id="parameter-naming">Parameter Naming<a class="anchor" aria-label="anchor" href="#parameter-naming"></a></h3>
<p>Follow dplyr conventions: - <code>x</code>, <code>y</code> for data frames (not <code>df1</code>, <code>df2</code>) - <code>by</code> for join columns (character vector or named vector) - Use snake_case throughout</p>
</div>
<div class="section level3">
<h3 id="return-values">Return Values<a class="anchor" aria-label="anchor" href="#return-values"></a></h3>
<ul><li>Diagnostic functions return <code>JoinReport</code> S3 objects with custom <code><a href="https://rdrr.io/r/base/print.html" class="external-link">print()</a></code> method</li>
<li>Safe wrappers return the joined data frame with report as attribute</li>
<li>Use <code><a href="https://rdrr.io/r/base/invisible.html" class="external-link">invisible()</a></code> for side-effect functions</li>
</ul></div>
<div class="section level3">
<h3 id="error-handling">Error Handling<a class="anchor" aria-label="anchor" href="#error-handling"></a></h3>
<ul><li>Use <code>stop(..., call. = FALSE)</code> for user-facing errors</li>
<li>Use <code><a href="https://rdrr.io/r/base/warning.html" class="external-link">warning()</a></code> for recoverable issues</li>
<li>Use <code><a href="https://rdrr.io/r/base/message.html" class="external-link">message()</a></code> for informational output (can be suppressed)</li>
</ul></div>
</div>
<div class="section level2">
<h2 id="testing-guidelines">Testing Guidelines<a class="anchor" aria-label="anchor" href="#testing-guidelines"></a></h2>
<ul><li>Use <code><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed()</a></code> for any randomized test data</li>
<li>Test edge cases: empty data frames, single row, all duplicates, no matches</li>
<li>Test encoding issues with explicit UTF-8 strings</li>
<li>Test both character and named vector <code>by</code> specifications</li>
<li>Include tests for tibbles, data.tables, and base data.frames</li>
</ul></div>
<div class="section level2">
<h2 id="documentation-1">Documentation<a class="anchor" aria-label="anchor" href="#documentation-1"></a></h2>
<p>All exported functions use roxygen2 documentation with: - <code>@param</code> descriptions matching dplyr style - <code>@return</code> describing the <code>JoinReport</code> structure - <code>@details</code> explaining what issues are detected - <code>@examples</code> using built-in datasets (mtcars, iris) or small synthetic data - <code>@seealso</code> linking related functions</p>
</div>
<div class="section level2">
<h2 id="dependencies">Dependencies<a class="anchor" aria-label="anchor" href="#dependencies"></a></h2>
<p>Keep dependencies minimal: - <strong>Imports</strong>: rlang (for tidy evaluation if needed), cli (for pretty printing) - <strong>Suggests</strong>: dplyr, data.table, tibble, testthat, knitr, rmarkdown</p>
<p>The package should work with base R joins (<code><a href="https://rdrr.io/r/base/merge.html" class="external-link">merge()</a></code>) and dplyr joins.</p>
</div>
</div>

  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Gilles Colling.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

